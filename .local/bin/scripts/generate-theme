#!/bin/sh

# requires find and sed
require-cmd find sed || exit 1

# load the theme config file
[ -r "${XDG_DATA_HOME:-$HOME/.local/share}/dots/themes/theme.conf" ] && {
    . "${XDG_DATA_HOME:-$HOME/.local/share}/dots/themes/theme.conf"
} || {
    printf "${0##*/}: error: ${XDG_DATA_HOME:-$HOME/.local/share}/dots/themes/theme.conf: File or directory nonexistent or unreadable\n"
    exit 1
}

# generate theme-specific config files from templates
for i in $(find ${XDG_CONFIG_HOME:-$HOME/.config} ${XDG_DATA_HOME:-$HOME/.local/share} -type f -name '___*'); do
    dir="${i%/*}"
    name="${i##*___}"
    printf "sed <$i >$dir/$name\n"
    sed \
        -e "s/#::font-monospace::#/$theme_font_monospace/g" \
        -e "s/#::font-serif::#/$theme_font_serif/g" \
        -e "s/#::font-sans::#/$theme_font_sans/g" \
        -e "s/#::font-sans-serif::#/$theme_font_sans_serif/g" \
        -e "s/#::vim-colorscheme::#/${theme_vim_colorscheme:-default}/g" \
        -e "s/#::background0::#/$theme_background0/g" \
        -e "s/#::background1::#/$theme_background1/g" \
        -e "s/#::background2::#/$theme_background2/g" \
        -e "s/#::background3::#/$theme_background3/g" \
        -e "s/#::background4::#/$theme_background4/g" \
        -e "s/#::background5::#/$theme_background5/g" \
        -e "s/#::background6::#/$theme_background6/g" \
        -e "s/#::background7::#/$theme_background7/g" \
        -e "s/#::background8::#/$theme_background8/g" \
        -e "s/#::background9::#/$theme_background9/g" \
        -e "s/#::background10::#/$theme_background10/g" \
        -e "s/#::background11::#/$theme_background11/g" \
        -e "s/#::background12::#/$theme_background12/g" \
        -e "s/#::background13::#/$theme_background13/g" \
        -e "s/#::foreground0::#/$theme_foreground0/g" \
        -e "s/#::foreground1::#/$theme_foreground1/g" \
        -e "s/#::foreground2::#/$theme_foreground2/g" \
        -e "s/#::foreground3::#/$theme_foreground3/g" \
        -e "s/#::foreground4::#/$theme_foreground4/g" \
        -e "s/#::foreground5::#/$theme_foreground5/g" \
        -e "s/#::blue0::#/$theme_blue0/g" \
        -e "s/#::blue1::#/$theme_blue1/g" \
        -e "s/#::blue2::#/$theme_blue2/g" \
        -e "s/#::blue3::#/$theme_blue3/g" \
        -e "s/#::blue4::#/$theme_blue4/g" \
        -e "s/#::red0::#/$theme_red0/g" \
        -e "s/#::red1::#/$theme_red1/g" \
        -e "s/#::red2::#/$theme_red2/g" \
        -e "s/#::red3::#/$theme_red3/g" \
        -e "s/#::red4::#/$theme_red4/g" \
        -e "s/#::green0::#/$theme_green0/g" \
        -e "s/#::green1::#/$theme_green1/g" \
        -e "s/#::green2::#/$theme_green2/g" \
        -e "s/#::green3::#/$theme_green3/g" \
        -e "s/#::green4::#/$theme_green4/g" \
    <"$i" >"$dir/$name"
done
